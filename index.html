<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Bouncy Ball</title>
        <style>
            #board{
                border-collapse: collapse;
            }

            .board{
                border: 0px solid black;
            }

            .board-padding{
                background-color: white;
                border: 0px solid black;
                box-shadow: 10px 10px 30px rgba(0, 0, 0, 0.5);
                padding: calc(var(--cell-size) / 2);
            }

            .center{
                transform: translate(-50%, -50%);
                position: absolute;
                top: 50%;
                left: 50%;
            }

            .hide{
                display: none;
            }
        </style>
    </head>

    <img>
        <div id="tableMap" class="board-padding board"></div>
        <div id="divBall" style="background-color: #f6f600; position: absolute; left: 10px; top: 10px; width: 10px; height: 10px; border-radius: 5px;"></div>
    </body>
    <script>
        var divBall = document.getElementById("divBall");
        var tableBoard = document.getElementById("tableMap");

        var arrMap = [
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 1, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 1, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 2, 2, 0, 0, 0, 0],
            [1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 2, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
        ];

        var ball = {
            element: document.querySelector("#divBall"),

            directionX: 0, //0 : Down, 1 : Up
            directionY: 1, //0 : Left, 1 : Right
            
            forceX: 0,
            forceY: 0,

            a: 0.1,

            styleX: (value) => {
                if(value != null){
                    document.querySelector("#divBall").style.left = value;
                }
                return document.querySelector("#divBall").style.left;
            },
            styleY: document.querySelector("#divBall").style.top,
        };

        var arrStar = [];
        var countStar = 0;

        var cng1 = 0; // 0 : None, 1 : Up, 2 : Right, 3 : Down, 4 : Left
        var cng2 = 0;
        var cng3 = 0;
        var cng4 = 0;

        drawBoard();
        setInterval(main, 17);

        function main(){
            moveBall();

            x = removePX(divBall.style.left);
            y = removePX(divBall.style.top);

            x1 = Math.floor(x / 20);
            y1 = Math.floor(y / 20);

            x2 = Math.floor((x + 10) / 20);
            y2 = Math.floor(y / 20);

            x3 = Math.floor(x / 20);
            y3 = Math.floor((y + 10) / 20);

            x4 = Math.floor((x + 10) / 20);
            y4 = Math.floor((y + 10) / 20);

            if(isOutOfMap(x, y)){
                location.reload();
            }

            for(var i = 0; i < arrStar.length; i++){
                if(x1 <= arrStar[i][1] && arrStar[i][1] <= x2){
                    if(y1 <= arrStar[i][0] && arrStar[i][0] <= y2){
                        var listCellStars = document.querySelectorAll("#divStar");

                        for(var j = 0; j < listCellStars.length; j++){
                            if(removePX(listCellStars[j].style.left) == arrStar[i][1] * 20){
                                listCellStars[j].style.backgroundColor = "white";

                                arrMap[Math.floor(y / 20), Math.floor(x / 20)] = 0;
                                arrStar[i][0] = 0;
                                arrStar[i][1] = 0;
                                countStar--;
                            }
                        }
                    }
                }
            }

            var reverseForceX = -ball.forceX;
            var reverseForceY = -ball.forceY;

            if(cng1 != 0){
                if(cng1 == 1){
                    if(arrMap[y1][x1]){
                        ball.forceY = reverseForceY;
                    }
                }else if(cng1 == 4){
                    if(arrMap[y1][x1]){
                        ball.forceX = 3.0;
                        divball.style.left = removePX(divBall.style.left) + ball.forceX + "px";
                    }
                }
            }

            if(cng2 != 0){
                if(cng2 == 1){
                    if(arrMap[y2][x2]){
                        ball.forceY = reverseForceY;
                    }
                }else if(cng2 == 2){
                    if(arrMap[y2][x2]){
                        ball.forceX = -3.0;
                        divball.style.left = removePX(divBall.style.left) + ball.forceX + "px";
                    }
                }
            }

            if(cng3 != 0){
                if(cng3 == 4){
                    if(arrMap[y3][x3]){
                        ball.forceX = 3.0;
                        divball.style.left = removePX(divBall.style.left) + ball.forceX + "px";
                    }
                }else if(cng3 == 3){
                    if(arrMap[y3][x3]){
                        ball.forceY = -3.5;
                    }
                }
            }

            if(cng4 != 0){
                if(cng4 == 2){
                    if(arrMap[y4][x4]){
                        ball.forceX = -3.0;
                        divball.style.left = removePX(divBall.style.left) + ball.forceX + "px";
                    }
                }else if(cng4 == 3){
                    if(arrMap[y4][x4]){
                        ball.forceY = -3.5;
                    }
                }
            }
        }

        isLeft = false;
        isRight = false;

        document.onkeypress = function(e){
            switch(e.key){
                case 'a':
                    isLeft = true;
                    break;
                case 'd':
                    isRight = true;
                    break;
            }
        }

        document.onkeyup = function(e){
            switch(e.key){
                case 'a':
                    isLeft = false;
                    break;
                case 'd':
                    isRight = false;
                    break;
            }
        }

        function drawBoard(){
            for(var i = 0; i < arrMap.length; i++){
            for(var j = 0; j < arrMap[i].length; j++){
                var cell = document.createElement("div");
                cell.style.position = "absolute";
                cell.style.height = "20px";
                cell.style.width = "20px";
                cell.style.left = j * 20 + "px";
                cell.style.right = i * 20 + "px";

                if(arrMap[i][j] == 0){
                    cell.style.backgroundColor = "white";
                    cell.setAttribute("isGround", false);
                }else if(arrMap[i][j] == 1){
                    cell.style.backgroundColor = "black";
                    cell.setAttribute("isGround", true);
                }else if(arrMap[i][j] == 2){
                    arrStar.push([i, j]);
                    countStar++;

                    cell.style.backgroundColor = "yellow";
                    cell.setAttribute("isGround", false);
                    cell.id = "divStar";
                }

                tableBoard.appendChild(cell);
            }
        }

        function isOutOfMap(x, y){
            if(x / 20 < 30 && y / 20 < 20){
                return false;
            }

            return true;
        }

        function moveBall(){
            if(isLeft & !isRight){
                ball.directionX = 0;
            }else if(!isLeft && isRight){
                ball.directionX = 2;
            }else{
                ball.directionX = 1;
            }

            if(ball.directionX == 0){
                ball.forceX = -2.5;
            }else if(ball.directionX == 2){
                ball.forceX = 2.5;
            }
            
            if(ball.forceX > 10){
                ball.forceX = 10;
            }else if(ball.forceX < -10){
                ball.forceX = -10;
            }

            setEnergy();
        }

        function removePX(point){
            return Number(point.split("px")[0]);
        }

        function setEnergy(){
            if(ball.forceX != 0){
                if(ball.forceX > 0){
                    ball.forceX -= 0.2;

                    if(ball.forceX < 0){
                        ball.forceX = 0;
                    }
                }else{
                    ball.forceX += 0.2;

                    if(ball.forceX > 0){
                        ball.forceX = 0;
                    }
                }
            }

            ball.forceY += 0.2;

            x = removePX(divBall.style.left);
            y = removePX(divBall.style.top);

            x1 = Math.floor(x / 20);
            mx1 = Math.floor((x + ball.forceX) / 20);
            y1 = Math.floor(y / 20);
            my1 = Math.floor((y + ball.forceY) / 20);

            x2 = Math.floor((x + 10) / 20);
            mx2 = Math.floor(((x + 10) + ball.forceX) / 20);
            y2 = Math.floor(y / 20);
            my2 = Math.floor((y + ball.forceY) / 20);

            x3 = Math.floor(x / 20);
            mx3 = Math.floor((x + ball.forceX) / 20);
            y3 = Math.floor((y + 10) / 20);
            my3 = Math.floor(((y + 10) + ball.forceY) / 20);

            x4 = Math.floor((x + 10) / 20);
            mx4 = Math.floor(((x + 10) + ball.forceX) / 20);
            y4 = Math.floor((y + 10) / 20);
            my4 = Math.floor(((y + 10) + ball.forceY) / 20);

            if(x1 > mx1){
                cng1 = 4;
            }
            if(y1 > my1){
                cng1 = 1;
            }
            
            if(x2 < mx2){
                cng2 = 2;
            }
            if(y2 > my2){
                cng2 = 1;
            }
            
            if(x3 > mx3){
                cng3 = 4;
            }
            if(y3 < my3){
                cng3 = 3;
            }
            
            if(x4 < mx4){
                cng4 = 2;
            }
            if(y4 < my4){
                cng4 = 3;
            }

            divBall.style.left = x + ball.forceX + "px";
            divBall.style.top = y + ball.forceY + "px";
        }
    }
    </script>
</html>
